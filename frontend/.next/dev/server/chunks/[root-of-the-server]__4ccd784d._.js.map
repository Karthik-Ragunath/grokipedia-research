{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 64, "column": 0}, "map": {"version":3,"sources":["file:///Users/dpang/dev/grokipedia-research/frontend/app/api/grpo-videos/route.ts"],"sourcesContent":["import { NextResponse } from 'next/server'\nimport { readdir, stat } from 'fs/promises'\nimport { join, resolve } from 'path'\nimport { existsSync } from 'fs'\n\n// Resolve paths relative to the project root (one level up from frontend)\nconst PROJECT_ROOT = resolve(process.cwd(), '..')\nconst GRPO_VIDEOS_DIR = join(PROJECT_ROOT, 'paper-manim-viz-explanations/grpo-explainer/generated_videos/reinforcement_learning')\n\ninterface VideoItem {\n  id: string\n  title: string\n  description: string\n  videoPath: string\n  chunkNumber: number\n  header: string\n  chunkDir?: string // Optional: for matching with markdown files\n}\n\n// Recursively find all video.mp4 files\nasync function findVideoFiles(dir: string, basePath: string = ''): Promise<Array<{ path: string, relativePath: string }>> {\n  const videos: Array<{ path: string, relativePath: string }> = []\n  \n  try {\n    const entries = await readdir(dir, { withFileTypes: true })\n    \n    for (const entry of entries) {\n      const fullPath = join(dir, entry.name)\n      const relativePath = basePath ? join(basePath, entry.name) : entry.name\n      \n      if (entry.isDirectory()) {\n        // Recursively search in subdirectories\n        const subVideos = await findVideoFiles(fullPath, relativePath)\n        videos.push(...subVideos)\n      } else if (entry.name === 'video.mp4') {\n        videos.push({ path: fullPath, relativePath })\n      }\n    }\n  } catch (error) {\n    console.error(`Error reading directory ${dir}:`, error)\n  }\n  \n  return videos\n}\n\nexport async function GET() {\n  try {\n    if (!existsSync(GRPO_VIDEOS_DIR)) {\n      console.error(`GRPO_VIDEOS_DIR does not exist: ${GRPO_VIDEOS_DIR}`)\n      return NextResponse.json({ error: `GRPO videos directory not found: ${GRPO_VIDEOS_DIR}` }, { status: 500 })\n    }\n    \n    const videoItems: VideoItem[] = []\n    \n    // Find all video.mp4 files recursively\n    const videoFiles = await findVideoFiles(GRPO_VIDEOS_DIR)\n    \n    // Sort by path to maintain consistent order\n    videoFiles.sort((a, b) => a.relativePath.localeCompare(b.relativePath))\n    \n    for (const videoFile of videoFiles) {\n      // Extract chunk info from path\n      // e.g., chunk_01_introduction_to_grpo/video.mp4\n      // or chunk_08_training_and_evaluation_setup/reinforcement_learning/chunk_08_training_and_evaluation_setup/video.mp4\n      const pathParts = videoFile.relativePath.split('/')\n      const chunkDir = pathParts[0] // First directory is the chunk directory\n      \n      // Extract chunk number and name\n      const match = chunkDir.match(/chunk_(\\d+)_(.+)/)\n      if (!match) continue\n      \n      const chunkNumber = parseInt(match[1], 10)\n      const chunkName = match[2]\n      \n      // Format title from chunk name\n      const title = chunkName.replace(/_/g, ' ').replace(/\\b\\w/g, l => l.toUpperCase())\n      \n      // Use the relative path for the API endpoint\n      // Remove 'video.mp4' and use the directory path\n      const apiPath = videoFile.relativePath.replace(/\\/video\\.mp4$/, '')\n      \n      videoItems.push({\n        id: `grpo_chunk_${chunkNumber}`,\n        title,\n        description: `GRPO: ${title}`,\n        videoPath: `/api/grpo-video/${apiPath}`,\n        chunkNumber,\n        header: chunkName,\n        chunkDir: chunkDir, // Store chunk directory name for markdown lookup\n      })\n    }\n    \n    return NextResponse.json({ videos: videoItems })\n  } catch (error) {\n    console.error('Error loading GRPO videos:', error)\n    return NextResponse.json({ error: 'Failed to load GRPO videos' }, { status: 500 })\n  }\n}\n\n"],"names":[],"mappings":";;;;AAAA;AACA;AACA;AACA;;;;;AAEA,0EAA0E;AAC1E,MAAM,eAAe,IAAA,4GAAO,EAAC,QAAQ,GAAG,IAAI;AAC5C,MAAM,kBAAkB,IAAA,yGAAI,EAAC,cAAc;AAY3C,uCAAuC;AACvC,eAAe,eAAe,GAAW,EAAE,WAAmB,EAAE;IAC9D,MAAM,SAAwD,EAAE;IAEhE,IAAI;QACF,MAAM,UAAU,MAAM,IAAA,gIAAO,EAAC,KAAK;YAAE,eAAe;QAAK;QAEzD,KAAK,MAAM,SAAS,QAAS;YAC3B,MAAM,WAAW,IAAA,yGAAI,EAAC,KAAK,MAAM,IAAI;YACrC,MAAM,eAAe,WAAW,IAAA,yGAAI,EAAC,UAAU,MAAM,IAAI,IAAI,MAAM,IAAI;YAEvE,IAAI,MAAM,WAAW,IAAI;gBACvB,uCAAuC;gBACvC,MAAM,YAAY,MAAM,eAAe,UAAU;gBACjD,OAAO,IAAI,IAAI;YACjB,OAAO,IAAI,MAAM,IAAI,KAAK,aAAa;gBACrC,OAAO,IAAI,CAAC;oBAAE,MAAM;oBAAU;gBAAa;YAC7C;QACF;IACF,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC,CAAC,wBAAwB,EAAE,IAAI,CAAC,CAAC,EAAE;IACnD;IAEA,OAAO;AACT;AAEO,eAAe;IACpB,IAAI;QACF,IAAI,CAAC,IAAA,2GAAU,EAAC,kBAAkB;YAChC,QAAQ,KAAK,CAAC,CAAC,gCAAgC,EAAE,iBAAiB;YAClE,OAAO,gJAAY,CAAC,IAAI,CAAC;gBAAE,OAAO,CAAC,iCAAiC,EAAE,iBAAiB;YAAC,GAAG;gBAAE,QAAQ;YAAI;QAC3G;QAEA,MAAM,aAA0B,EAAE;QAElC,uCAAuC;QACvC,MAAM,aAAa,MAAM,eAAe;QAExC,4CAA4C;QAC5C,WAAW,IAAI,CAAC,CAAC,GAAG,IAAM,EAAE,YAAY,CAAC,aAAa,CAAC,EAAE,YAAY;QAErE,KAAK,MAAM,aAAa,WAAY;YAClC,+BAA+B;YAC/B,gDAAgD;YAChD,oHAAoH;YACpH,MAAM,YAAY,UAAU,YAAY,CAAC,KAAK,CAAC;YAC/C,MAAM,WAAW,SAAS,CAAC,EAAE,CAAC,yCAAyC;;YAEvE,gCAAgC;YAChC,MAAM,QAAQ,SAAS,KAAK,CAAC;YAC7B,IAAI,CAAC,OAAO;YAEZ,MAAM,cAAc,SAAS,KAAK,CAAC,EAAE,EAAE;YACvC,MAAM,YAAY,KAAK,CAAC,EAAE;YAE1B,+BAA+B;YAC/B,MAAM,QAAQ,UAAU,OAAO,CAAC,MAAM,KAAK,OAAO,CAAC,SAAS,CAAA,IAAK,EAAE,WAAW;YAE9E,6CAA6C;YAC7C,gDAAgD;YAChD,MAAM,UAAU,UAAU,YAAY,CAAC,OAAO,CAAC,iBAAiB;YAEhE,WAAW,IAAI,CAAC;gBACd,IAAI,CAAC,WAAW,EAAE,aAAa;gBAC/B;gBACA,aAAa,CAAC,MAAM,EAAE,OAAO;gBAC7B,WAAW,CAAC,gBAAgB,EAAE,SAAS;gBACvC;gBACA,QAAQ;gBACR,UAAU;YACZ;QACF;QAEA,OAAO,gJAAY,CAAC,IAAI,CAAC;YAAE,QAAQ;QAAW;IAChD,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC,8BAA8B;QAC5C,OAAO,gJAAY,CAAC,IAAI,CAAC;YAAE,OAAO;QAA6B,GAAG;YAAE,QAAQ;QAAI;IAClF;AACF"}}]
}